---
title: 代码整洁之道读书笔记
description: 代码整洁之道读书笔记
layout: post
author: 陈家辉
tags:
- 读书笔记
---

# 第一章 整洁代码

**简单代码的特性（先后顺序代表重要程度）**

> 1. 能通过所有测试
> 2. 没有重复代码
> 3. 体现系统中的全部设计概念
> 4. 包括尽量少的尸体，比如类、方法、函数等

**代码越简单越容易扩展**

**童子军军规：让营地比你来时更干净**

代码会随着时间的流逝而腐坏，需要时时保持代码整洁

# 第二章 有意义的命名

软件中命名随处可见，变量、函数、参数、类和封包命名、源代码都需要命名，以下是几条简单规则来帮助取好名字。

## 名副其实

名字一定要准确，不要取 theList、x、arg1...

## 避免误导

错误例子：

```java
Set<Account> accountList;
```

在同一域中避免使用名字相近的命名，如果在一个域中碰到下面两个类，需要花多长时间才能区分清楚呢？

```java
XYZControllerForEfficientHandlingOfStrings;
XYZControllerForEfficientStorageOfStrings
```



## 做有意义的区分

**正确示例**

有两个变量 arg1、arg2，如果改为source、destination，就会非常清楚的看出这两个变量的用处。

**错误示例**

| 好的命名 | 无意义的命名   |
| -------- | -------------- |
| Name     | NameString     |
| Customer | CustomerObject |
| Money    | MoneyAmount    |



## 使用读的出来的名称

| 坏的命名  | 改进的命名            |
| --------- | --------------------- |
| genymdhms | generationTimestamp   |
| modymdhms | modificationTimestamp |



## 使用可搜索的名称

例如使用 WORK_DAYS_PER_WEEK 代替 5，这对于全局搜索来说更为友好



## 避免使用编码

匈牙利语标记法：早期编译器不做类型检查，所以特别喜欢使用类型编码，例如phoneString，然而对于Java这种强类型语言来说完全是多余的。

成员前缀：不必用 m_ 来标记某个变量为成员变量，应当把类写的足够小来消除对前缀的需要。同时现在的ide完全可以通过颜色进行区分。

接口和实现：不要给接口加上不必要的I，这完全是多此一举的行为。

## 类名

类名应当使用名词或名词短语，避免直接使用Manager、Processor、Data、Info这样的类名。

## 方法名

方法名应当是动词或动词短语

## 别扮可爱

名称别太耍宝，要词到意到。

## 每个概念对应一个词

例如 fetch、get、retrieve如果同时出现在一个地方，你可以知道这三者的区别吗

## 使用专业的词

例如 Filter、Visitor 进行命名，程序员一眼就知道这个类的大致作用。

使用领域的专业名词，例如广告业务使用CPM、CPT。

## 不要添加没用的语境

例如一个项目叫做Youxuan，你需要写一个Config类，没必要叫YouxuanConfig

# 第三章 函数

## 短小

函数不该有那么长，20行封顶最佳

## 代码块和缩进

1. 代码块中应当只有一行函数调用
2. 函数的缩进层级不该多于两层

## 只做一件事

函数应该只做一件事情，做好这件事，只做一件事。

## 每个函数一个抽象层级

相同层级的操作可以放在一个函数中

**自顶向下读代码：向下规则**

## 使用描述性名称

1. 别害怕长名字
2. 使用动宾结构
3. 如果名字太长考虑一下是否是函数不够短小

## 函数参数

函数参数不应该太多，2个以内就是极限，如果参数过多，需要将参数进行聚合。

1. 尽量不要将入参作为修改对象
2. 不要使用Boolean作为入参，而应该拆成多个函数
3. 参数的顺序同样很重要

## 使用异常代替返回错误码

**抽离Try/Catch代码块**

最好把Try/Catch主体抽离出来，另外形成函数

```java
try{
	deletePageAndAllReferences(page)
}catch(Exception e){
    ...
}
```

**错误处理本身就是一件事**

try关键字应该是函数的第一个单词，在catch/finally之后也不应该有多余的代码

## 禁止重复代码

## 如何写出这样的函数

先实现功能，配合单元测试，进行打磨。

分解函数、修改名称、消除重复。

# 第四章 注释

## 注释不能美化糟糕的代码

注释并不能拯救糟糕的代码，最好的方法就是重构代码，通过代码去做阐述

## 好注释

**法律信息**

一些必要的法律信息，可以通过注释的方式将链接放在代码中

**提供信息的注释**

对于抽象类的抽象方法和接口的方法，注释是必要的

**对意图的解释**

在没有办法写出更好的代码时，可以用注释的方式表明你的想法

**警示**

对某些重要的核心代码，可以施加警示

**TODO注释**

## 坏注释

**喃喃自语**

注释不清晰，只有作者本人才知道是什么意思

**多余的注释**

从代码可以直观的看出这个函数的功能，就不必要施加额外的注释

like this

```java
// just wait for one minute
public void waitForOneMinute{
    ...
}
```

**误导性的注释**

注释可以没有，但绝对不能进行误导

**循规式注释**

规定每个函数都要有注释是愚蠢可笑的

**注释掉的代码**

不要的代码请直接删掉，由git进行管理，注释只会让代码变得异常难看

**非本地信息**

这种信息具有很大的不确定性，需要频繁修改

```java
/**
* It's 8080
* */
private int port;
```

**信息过多**

信息过多等于没有信息



# 第五章 格式

一个项目应当采取一个统一的、简单的格式规则，至少让人感觉整洁干净。一个功能可能在后续迭代中被改编，但是代码的格式和风格一般会跟随一个项目直到最后。

## 垂直格式

代码应该向报纸一样，从上往下渐次展开

**垂直方向的区隔**

每一行空格都应该有意义，让人能够一眼明了。例如每一个方法之间应该用空格隔开

**垂直方向上的靠近**

空白行隔开了概念，靠近的代码行则暗示了紧密的关联

变量应该离使用的地方最近，相关函数应该放在一起，被调用的函数应该放在调用函数的下方

## 横向格式

**水平方向上的区隔**

合适的空格能够让代码看起来更简单易懂

**缩进**

> 其实现在横向格式的要求 ide 的format基本都能够满足要求，我们只需要控制单行的长度，给出合理的换行方案。



# 第六章 对象

## 数据抽象

使用接口进行抽象，屏蔽具体的实现细节。遵循徳墨忒耳律，不要让使用者关心模块内部的实现。



# 第七章 错误处理

错误处理很重要，但是如果搞乱了代码逻辑，就是错误的做法。

## 使用异常而非返回码

使用try catch语句进行处理，远比多级返回码，每次都去做返回码判定更优雅。

## 使用不可控异常

可控异常的代价就是违反开闭原则，如果你的方法抛出一个可控异常，那么就要在catch语句和抛出异常处之间的每个方法签名中声明异常。

## 给出异常发生的环境说明

主动抛出的每个异常，都应当提供足够的环境说明，以便判断异常的来源的原因。

虽然java的异常堆栈可以看到异常的来源，但是无法表明抛出异常的初衷。

## 根据需要定义异常类

实现某个功能的时候，可能会调用多个第三方库，这有可能导致抛出多种异常，并且进行对应的异常处理。

但是对于我们的封装类而言，我们应该去定义一个相对统一的异常类来表明异常的场景。

## 别返回/传递 null 值

null值不仅需要去做空值校验，而且很容易出现空指针异常。

# 第十章 类

类应该从一组变量列表开始，如果有公共静态常量，应该先出现，然后是私有静态变量，私有实体变量，很少会有公共变量。

类应该短小，满足单一权责原则（SRP）

内聚，只有少量实体变量。一个类中的每个变量都被每个方法所使用，则该类具有最大的内聚性。保持内聚就会获得许多短小的类。

# 第十一章 系统

作为一个城市的创建者，很难对所有细节面面俱到，这就需要进行层级抽象，建造者可以进行顶层设计，各层级之间做好自己的事情就行了。
